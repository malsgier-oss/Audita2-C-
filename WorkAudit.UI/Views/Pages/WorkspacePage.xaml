<Page x:Class="WorkAudit.UI.Views.Pages.WorkspacePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:vm="clr-namespace:WorkAudit.UI.ViewModels"
      xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300" />
            <ColumnDefinition Width="5" />
            <ColumnDefinition Width="450" />
            <ColumnDefinition Width="5" />
            <ColumnDefinition Width="450" />
            <ColumnDefinition Width="5" />
            <ColumnDefinition Width="300" />
        </Grid.ColumnDefinitions>

        <!-- Column 1: Filter + Tabs -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <TabControl Grid.Row="1">
                <TabItem Header="Files">
                    <TreeView x:Name="FileTree" Margin="4" ItemsSource="{Binding FileTreeRoots}"
                              Expanded="FileTree_Expanded">
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate DataType="{x:Type vm:FileSystemNode}" ItemsSource="{Binding Children}">
                                <TextBlock Text="{Binding Name}" />
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                </TabItem>
                <TabItem Header="Documents">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Margin="4">
                            <TextBlock Text="Section" Margin="0,2" />
                            <ComboBox ItemsSource="{Binding SectionOptions}" SelectedItem="{Binding FilterSection}" Margin="0,0,0,4" />
                            <TextBlock Text="Status" Margin="0,2" />
                            <ComboBox ItemsSource="{Binding StatusOptions}" SelectedItem="{Binding FilterStatus}" Margin="0,0,0,4" />
                            <Button Content="Load" Command="{Binding LoadDocumentsCommand}" Margin="0,4,0,0" />
                        </StackPanel>
                        <DataGrid Grid.Row="1" ItemsSource="{Binding Documents}" SelectedItem="{Binding SelectedDocument}"
                                  AutoGenerateColumns="False" IsReadOnly="True" HeadersVisibility="Column" Margin="4"
                                  SelectionMode="Single" SelectionUnit="FullRow">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="40" />
                                <DataGridTextColumn Header="Type" Binding="{Binding DocumentType}" Width="80" />
                                <DataGridTextColumn Header="Date" Binding="{Binding CaptureTime}" Width="100" />
                                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </TabItem>
            </TabControl>
        </Grid>

        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" />

        <!-- Column 2: Web placeholder -->
        <Border Grid.Column="2" Background="WhiteSmoke" Margin="4">
            <TextBlock Text="Web (placeholder)" VerticalAlignment="Center" HorizontalAlignment="Center" />
        </Border>

        <GridSplitter Grid.Column="3" Width="5" HorizontalAlignment="Stretch" />

        <!-- Column 3: Preview -->
        <Border Grid.Column="4" BorderBrush="LightGray" BorderThickness="1" Margin="4" PreviewMouseWheel="Preview_PreviewMouseWheel">
            <Grid>
                <WebView2 x:Name="PreviewWebView" Visibility="Collapsed" />
                <TextBlock x:Name="PreviewPlaceholder" Text="Select a document to preview" VerticalAlignment="Center" HorizontalAlignment="Center" />
            </Grid>
        </Border>

        <GridSplitter Grid.Column="5" Width="5" HorizontalAlignment="Stretch" />

        <!-- Column 4: Inspector -->
        <ScrollViewer Grid.Column="6" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="8">
                <TextBlock Text="Inspector" FontWeight="SemiBold" Margin="0,0,0,8" />
                <TextBlock Text="Status" Margin="0,4,0,2" />
                <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                    <ComboBox ItemsSource="{Binding StatusOptions}" SelectedItem="{Binding Status}" Width="120" Margin="0,0,8,0" />
                    <Button Content="Apply" Command="{Binding ApplyStatusCommand}" />
                </StackPanel>
                <TextBlock Text="Notes" Margin="0,4,0,2" />
                <TextBox Text="{Binding Notes, UpdateSourceTrigger=PropertyChanged}" Height="80" TextWrapping="Wrap" AcceptsReturn="True" Margin="0,0,0,8" />
                <StackPanel Orientation="Horizontal">
                    <Button Content="Save Notes" Command="{Binding SaveNotesCommand}" Margin="0,0,8,0" />
                    <Button Content="Mark Reviewed" Command="{Binding MarkReviewedCommand}" Margin="0,0,8,0" />
                    <Button Content="Ready for Audit" Command="{Binding ReadyForAuditCommand}" Margin="0,0,8,0" />
                </StackPanel>
                <Button Content="Open File" Command="{Binding OpenFileCommand}" Margin="0,8,0,0" HorizontalAlignment="Left" />
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
